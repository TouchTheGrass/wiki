# Введение

Данный документ описывает спецификацию требований к системе многопользовательской игры "Three-player Chess".

## Назначение

Данная система разрабатывается для аттестации команды исполнителей по предмету "Технологии разработки программного обеспечения" направления магистратуры "Информатика и вычислительная техника" СПБГПУ.

## Определения, акронимы и сокращения

Игровое лобби – сущность, характеризующая группу пользователей, количество которых не превышает лимит, установленный правилами игры.

Игровая сессия – сущность, характеризующая сеанс игры, в которой участвуют только участники лобби, для которого создавалась сессия.

Мат – ситуация в шахматах, когда король находится под шахом, и игрок не может сделать ни одного хода, чтобы его избежать.

Система управления базами данных, СУБД – комплекс программ, обеспечивающих управление созданием и использованием баз данных.

Шах — ситуация в шахматах и их вариантах, когда король находится под боем, то есть под угрозой взятия на следующем ходу.

Шахматы – настольная логическая игра с шахматными фигурами: король, ферзь, ладья, слон, конь и пешка. Во всех правилах главная цель игры - поставить мат королю соперника.

## Краткий обзор

Данный проект реализует клиент-серверную систему для онлайн-игры нескольких пользователей по одному из выбранных наборов правил в шахматы на троих. Истема также обеспечивает ведение статистики и истории игр для каждого зарегестрированного пользователя.

# Общее описание

## Взаимодействие продукта

Система содержит в себе 2 макроэлемента:

- серверная часть
- клиентская часть

### Серверная часть

Серверное приложение реализуется при помощи фреймворка Django на языке программирования Python. Данный фреймворк позволит обеспечивать обработку данных поступающих при взаимодействии с клиентской частью и с другими микросервисами на серверной части (например с СУБД, взаимодействие с большинством известных решений поддерживается в Django по умолчанию, с другими сервисами возможно взаимодействие при помощи различных протоколов типа http, websockets и т.д.).

### Клиентская часть

Клиентское приложение должно предоставлять пользователю графический интерфейс для дальнейшего взаимодействия с серверной частью. Требуется реализовать поддержку графического интерфейса для двух платформ:

- веб-браузеры (оптимизация под десктопные аппаратные конфигурации)
- OC Android

Для разработки браузерного клиента используется фреймворк React на языке программирования TypeScript, позволяющий описать графические отображение и поведение веб-интерфейсов, а ткже позволяющий обеспечить взаимодействие с серверной частью (один из протоколов, что поддерживается серверной частью).

Для реализации приложения для OC Android используется фреймворк Jetpack Compose на языке программирования Kotlin, позволяющий описать отображение и поведение графический интерфейс Android-приложения.

## Функции продукта

Далее представлен списки модулей, каждый из которых реализует набор соответствующий набор функций.

### Серверная часть

#### Модуль аутентификации пользователей

Модуль реализует аутентификацию пользователей и разграничение доступа при использовании системы. 

Разграничение доступа подразумевает невозможность совершения действий, доступных определенному(-ым) пользователю(-ям), от лица других пользователей. 

#### Модуль игрового лобби

Модуль реализует функции создания и управления игровым лобби. Данный модуль должен обеспечивать соблюдение правил, описанных далее.

Каждый пользователь (здесь и далее под пользователем будет подразумеваться аутентифицированный пользователь) может создать игровое лобби, автоматически становясь его членом и администратором. Администратор может исключать других игроков из лобби, изменять набор игровых правил и инициировать игровую сессию данного лобби (при условии, что в лобби максимальное количество человек).

Любой пользователь может подключиться к любому лобби, если не превышен лимит пользователей этого лобби (максимум к лобби может быть подключено 3 человека). Любой участник лобби может в любой момент отключиться от этого лобби, если не инициирована игровая сессия для данного лобби.

Для каждого лобби может быть инициировано не более одной игровой сессии.

Также модуль обеспечивает отображение информации о всех лобби, доступных для подключения.

#### Модуль бизнес логики игры 

Модуль реализует функции создания и управления игровой сессией. Данный модуль должен обеспечивать соблюдение правил, описанных далее.

Каждая игровая сессия привязана к конкретному игровому лобби, т.е. в ней могут участвовать только участники этого лобби. Каждому участнику лобби соответствует один из 3 цветов - белый, черный, красный.

Игровая сессия может иметь одно из следующих состояний:

- Ожидание готовности игроков

- Игра
- Завершено

Состояние "Ожидание готовности игроков" присваивается при создании игровой сессии. В данном состоянии участники могут только сообщить о своей готовности или покинуть лобби.

Состояние "Игра" присваивается после того, как все участники сообщили о своей готовности. В данном состоянии пользователям в очередном порядке предоставляется возможность в соответствии с правилами игры совершить одну манипуляцию с подконтрольной ему шахматной фигурой.

Очередность зависит от соответствующего игроку цвета в соответствии со следующим циклом: сначала игрок с белым цветом, затем с черным, затем с красным, переход в начало цикла.

Состояние "Завершено" присваивается после того, как были соблюдены условия победы, или если потеряно соединение с одним из игроков.

Модуль должен как минимум реализовывать следующий набор правил:

- Доска с 96 четырехугольными клетками.
- Изначальная расстановка фигур:

![Расстановка фигур](https://upload.wikimedia.org/wikipedia/commons/thumb/d/dd/Chess_for_Three_-_Hexagonal_Board.jpg/1280px-Chess_for_Three_-_Hexagonal_Board.jpg)

- У каждого игрока по 16 фигур.
- Пешка – подобно обычным шахматам, ходит вперёд по вертикали, бьет по диагонали. В центре у пешки три клетки под боем. Половина пешек идёт налево, половина — направо.

- Слон – как в обычных шахматах, ходит и бьет по диагоналям. Диагоналями считаются ломаные линии, состоящие из отрезков — диагоналей клеток одного цвета. Таким образом, из угловой клетки доски слон может перейти на обе остальные угловые клетки того же цвета.
- Ладья – как в обычных шахматах, ходит и бьет по горизонталям и вертикалям. Горизонталями и вертикалями считаются ломаные линии, состоящие из отрезков, соединяющих противоположные стороны клеток.
- Конь – две клетки по горизонтали, затем одна по вертикали; либо две по вертикали, затем одна по горизонтали. Перепрыгивает через фигуры.
- Ферзь – ходит, как слон и как ладья.
- Право первого хода определяется жребием. 
- Все фигуры игрока, получившего мат первым, кроме короля, остаются на своих местах и переходят к игроку, поставившему мат, после чего игра продолжается. 
- Игрок, которому принадлежат фигуры двух цветов, каждый очередной ход делает только одной фигурой любого из двух цветов, при этом они больше не могут бить друг друга.
- Условия победы: двум из трех игроков поставлен мат.

Также модуль реализует отображение возможных манипуляций для каждого игрока на каждом ходу и валидацию осуществляемых игроками манипуляций.

#### Модуль для хранения данных

Модуль реализует функции записи, чтения, редактирования и удаления данных, фигурирующих в системе.

В модуле должна быть возможность обработки следующих сущностей в виде данных:

- пользователь
  - имя
  - данные аутентификации
  - рейтинг
- игровое лобби
  - набор правил
  - набор участников
- игровая сессия
  - связь с игровым лобби
  - игровая доска (положение шахматных фигур)
  - история ходов

#### Модуль для взаимодействия с клиентской частью

Модуль реализует функции для обмена данными с клиентской частью.

### Клиентская часть

Поскольку разрабатываются 2 отдельные реализации клиентской части, данный список затрагивает оба варианта.

#### Модуль отображения интерактивных элементов

Включает отображение следующих абстрактных групп в виде некоторого множества веб-страниц, view или других UI-элементов:

- аутентификация
- главное меню
- профиль пользователя
- игровое лобби 
- игровая сессия

#### Модуль для взаимодействия с серверной частью

Модуль реализует функции для обмена данными с серверной частью.

## Характеристики пользователя

Помимо разработчиков системы, потенциальную аудиторию пользователей составляют:

- Ицыксон Владимир Михайлович
- Соболь Валентин Олегович

# Вопросы и уточнения

Уточнить список поддерживаемых браузеров.

Уточнить поддерживаемые модели смартфонов, их тех. характеристики и версии ОС.

Уточнить форматы аутентификации пользователей.

Уточнить типы игрового лобби (открытые и закрытые)

Уточнить возможность добавления наблюдателей 

Уточнить набор статических и изменяемых (опциональных) правил игры

Уточнить способы распределения цветов фигур между участниками игровой сессии

Уточнить когда и как участники могут покинуть игровую сессию и игровое лобби

Уточнить действия при выходе участников из игровой сессии

Уточнить состояния игровой сессии

Уточнить информацию, содержащуюся в истории игр пользователей
